---
interface Props {
  title: string;
  description?: string;
  image?: string;
}

const { 
  title, 
  description = "P1 Speedway - Viviendo la Velocidad Al Límite. La mejor pista de kartismo en Costa Rica.",
  image = "/og-image.webp"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site ?? Astro.url);

// Check if we are on the homepage for specific styling (like absolute transparent navbar on top vs solid)
const isHomePage = Astro.url.pathname === '/' || Astro.url.pathname === '/';

import P1logo from '../assets/images/P1logo.webp';
import favicon from '../assets/images/favicon.svg';
import EpsonLogo from '../assets/images/Epson-Logo.webp';
import LatinsoftLogo from '../assets/images/latinlogo.webp';
---

<!doctype html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href={favicon} />
    <link rel="canonical" href={canonicalURL} />
    <title>{title}</title>

    <!-- Open Graph / Facebook / WhatsApp -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.site ?? Astro.url)} />

    <!-- Twitter / Discord -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(image, Astro.site ?? Astro.url)} />
  </head>
  <body class="bg-black text-white antialiased overflow-x-hidden w-full font-sans">
    <header 
      id="main-nav" 
      class={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${
        isHomePage ? 'bg-transparent py-4 md:py-6' : 'bg-black/90 backdrop-blur-md py-3 shadow-md shadow-red-900/20'
      }`}
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <nav class={`flex items-center ${isHomePage ? 'justify-end md:justify-end' : 'justify-between'} w-full`}>
          {!isHomePage && (
            <a href="/" class="flex-shrink-0 transition-transform hover:scale-105" aria-label="Volver a Inicio">
              <img src={P1logo} alt="P1 Speedway Logo" class="h-10 md:h-14 w-auto object-contain" />
            </a>
          )}
          
          <!-- Mobile Menu Button -->
          <button 
            type="button" 
            id="mobile-menu-btn" 
            class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-300 hover:text-white hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-500"
            aria-controls="mobile-menu" 
            aria-expanded="false"
          >
            <span class="sr-only">Abrir menú principal</span>
            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>

          <!-- Desktop Menu -->
          <ul class="hidden md:flex space-x-6 lg:space-x-8 items-center text-sm lg:text-base font-medium tracking-wide">
            <li><a href="/" class="hover:text-red-500 transition-colors py-2 relative group">Inicio<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-red-600 transition-all group-hover:w-full"></span></a></li>
            <li><a href="#aboutus" class="hover:text-red-500 transition-colors py-2 relative group">Sobre Nosotros<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-red-600 transition-all group-hover:w-full"></span></a></li>
            <li><a href="/noticias" class="hover:text-red-500 transition-colors py-2 relative group">Noticias<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-red-600 transition-all group-hover:w-full"></span></a></li>
            <li><a href="#contacts" class="hover:text-red-500 transition-colors py-2 relative group">Contacto<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-red-600 transition-all group-hover:w-full"></span></a></li>
            <li><a href="/reglas" class="hover:text-red-500 transition-colors py-2 relative group">Reglas de Pista<span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-red-600 transition-all group-hover:w-full"></span></a></li>
          </ul>
        </nav>
      </div>

      <!-- Mobile Menu Overlay -->
      <div id="mobile-menu" class="fixed inset-0 w-screen h-screen z-[100] bg-black/95 backdrop-blur-md transform translate-x-full transition-transform duration-300 ease-in-out md:hidden flex flex-col">
        <div class="flex justify-between items-center p-4 border-b border-white/10">
          <img src={P1logo} alt="P1 Speedway Logo" class="h-10 w-auto object-contain" />
          <button type="button" id="close-mobile-menu" class="rounded-md p-2 text-gray-300 hover:text-white hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-500 transition-colors">
            <span class="sr-only">Cerrar menú</span>
            <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div class="flex-grow flex flex-col items-center justify-center p-6 overflow-y-auto">
          <ul class="flex flex-col space-y-8 text-center text-2xl font-bold tracking-wide w-full max-w-sm">
            <li><a href="/" class="block w-full text-white hover:text-red-500 py-3 border-b border-white/5 transition-colors mobile-link">Inicio</a></li>
            <li><a href="#aboutus" class="block w-full text-white hover:text-red-500 py-3 border-b border-white/5 transition-colors mobile-link">Sobre Nosotros</a></li>
            <li><a href="/noticias" class="block w-full text-white hover:text-red-500 py-3 border-b border-white/5 transition-colors mobile-link">Noticias</a></li>
            <li><a href="#contacts" class="block w-full text-white hover:text-red-500 py-3 border-b border-white/5 transition-colors mobile-link">Contacto</a></li>
            <li><a href="/reglas" class="block w-full text-white hover:text-red-500 py-3 transition-colors mobile-link">Reglas de Pista</a></li>
          </ul>
        </div>
      </div>
    </header>

    <main class="w-full flex-grow min-h-screen">
      <slot />
    </main>

    <footer id="contacts" class="bg-neutral-950 border-t border-neutral-900 py-16 pb-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col items-center justify-center space-y-12">
          
          <!-- Sponsors -->
          <div class="w-full text-center">
            <h3 class="text-xl font-bold tracking-wider uppercase text-neutral-400 mb-8">Nuestros Patrocinadores</h3>
            <div class="flex flex-wrap justify-center items-center gap-8 md:gap-16">
              <img src={EpsonLogo} alt="Epson" class="h-10 md:h-12 object-contain opacity-75 hover:opacity-100 transition-opacity grayscale hover:grayscale-0" />
              <img src={LatinsoftLogo} alt="Latinsoft" class="h-10 md:h-12 object-contain opacity-75 hover:opacity-100 transition-opacity grayscale hover:grayscale-0" />
            </div>
          </div>

          <div class="w-full h-px bg-neutral-900"></div>

          <!-- Contact Info -->
          <div class="text-center w-full">
            <h3 class="text-2xl font-bold mb-6 text-white">Contáctanos</h3>
            <div class="flex flex-col md:flex-row justify-center items-center gap-4 md:gap-8 text-neutral-300 mb-8">
              <a href="tel:+50671773339" class="hover:text-red-500 transition-colors flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-phone"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                +506 7177 3339
              </a>
              <span class="hidden md:inline text-neutral-700">|</span>
              <a href="mailto:gerencia@p1speedway.com" class="hover:text-red-500 transition-colors flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                gerencia@p1speedway.com
              </a>
            </div>
            
            <div class="flex justify-center items-center gap-6">
              <a href="https://facebook.com/p1speedway" target="_blank" rel="noopener noreferrer" class="bg-neutral-900 p-3 rounded-full text-neutral-400 hover:text-white hover:bg-red-600 transition-all" aria-label="Facebook">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M22.675 0H1.325C0.593 0 0 0.593 0 1.325V22.676C0 23.407 0.593 24 1.325 24H12.82V14.706H9.692V11.084H12.82V8.413C12.82 5.313 14.713 3.625 17.479 3.625C18.804 3.625 19.942 3.724 20.274 3.768V7.008L18.356 7.009C16.852 7.009 16.561 7.724 16.561 8.772V11.085H20.148L19.681 14.707H16.561V24H22.677C23.407 24 24 23.407 24 22.675V1.325C24 0.593 23.407 0 22.675 0Z"/>
                </svg>
              </a>
              <a href="https://instagram.com/p1speedway" target="_blank" rel="noopener noreferrer" class="bg-neutral-900 p-3 rounded-full text-neutral-400 hover:text-white hover:bg-red-600 transition-all" aria-label="Instagram">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path d="M12,2.16c3.2,0,3.58,0,4.85.07,3.25.15,4.77,1.69,4.92,4.92.06,1.27.07,1.65.07,4.85s0,3.58-.07,4.85c-.15,3.23-1.66,4.77-4.92,4.92-1.27.06-1.65.07-4.85.07s-3.58,0-4.85-.07c-3.26-.15-4.77-1.7-4.92-4.92-.06-1.27-.07-1.65-.07-4.85s0-3.58.07-4.85C2.38,3.92,3.9,2.38,7.15,2.23,8.42,2.18,8.8,2.16,12,2.16ZM12,0C8.74,0,8.33,0,7.05.07c-4.27.2-6.78,2.71-7,7C0,8.33,0,8.74,0,12s0,3.67.07,4.95c.2,4.27,2.71,6.78,7,7C8.33,24,8.74,24,12,24s3.67,0,4.95-.07c4.27-.2,6.78-2.71,7-7C24,15.67,24,15.26,24,12s0-3.67-.07-4.95c-.2-4.27-2.71-6.78-7-7C15.67,0,15.26,0,12,0Zm0,5.84A6.16,6.16,0,1,0,18.16,12,6.16,6.16,0,0,0,12,5.84ZM12,16a4,4,0,1,1,4-4A4,4,0,0,1,12,16ZM18.41,4.15a1.44,1.44,0,1,0,1.44,1.44A1.44,1.44,0,0,0,18.41,4.15Z"></path>
                </svg>
              </a>
            </div>
          </div>

          <!-- Copyright -->
          <div class="w-full text-center space-y-4 pt-6 text-neutral-500 text-sm border-t border-neutral-900">
            <p>Desarrollado por:</p>
            <a href="https://www.latinsoftcr.net/" target="_blank" rel="noopener noreferrer" class="inline-block transition-transform hover:scale-105"> 
              <img src={LatinsoftLogo} alt="Latinsoft Logo" class="h-10 mx-auto object-contain opacity-50 hover:opacity-100 transition-opacity"> 
            </a>
            <p>&copy; {new Date().getFullYear()} P1 Speedway. Todos los derechos reservados.</p>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // Navigation functionality
      document.addEventListener('DOMContentLoaded', () => {
        const header = document.getElementById('main-nav');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const closeMobileMenuBtn = document.getElementById('close-mobile-menu');
        const mobileMenu = document.getElementById('mobile-menu');
        const isHomePage = window.location.pathname === '/' || window.location.pathname === '/';

        // Fix para enlaces # (anclas) en páginas secundarias
        if (!isHomePage) {
          const hashLinks = document.querySelectorAll('a[href^="#"]');
          hashLinks.forEach(link => {
            link.addEventListener('click', (e) => {
              e.preventDefault();
              const target = link.getAttribute('href');
              if (target) window.location.href = '/' + target;
            });
          });
        }

        // Scroll listener for header styling
        if (isHomePage) {
          window.addEventListener('scroll', () => {
            if (window.scrollY > 20) {
              header?.classList.remove('bg-transparent', 'py-4', 'md:py-6');
              header?.classList.add('bg-black/90', 'backdrop-blur-md', 'py-3', 'shadow-md', 'shadow-red-900/20');
              const nav = header?.querySelector('nav');
              if (nav) {
                nav.classList.remove('justify-end');
                nav.classList.add('justify-center');
              }
            } else {
              header?.classList.add('bg-transparent', 'py-4', 'md:py-6');
              header?.classList.remove('bg-black/90', 'backdrop-blur-md', 'py-3', 'shadow-md', 'shadow-red-900/20');
              const nav = header?.querySelector('nav');
              if (nav) {
                nav.classList.add('justify-end');
                nav.classList.remove('justify-center');
              }
            }
          });
        }

        // Mobile menu toggle
        const toggleMenu = (open: boolean) => {
          if (open) {
            mobileMenu?.classList.remove('translate-x-full');
            document.body.classList.add('overflow-hidden'); // Prevent scrolling behind modal
          } else {
            mobileMenu?.classList.add('translate-x-full');
            document.body.classList.remove('overflow-hidden');
          }
        };

        mobileMenuBtn?.addEventListener('click', () => toggleMenu(true));
        closeMobileMenuBtn?.addEventListener('click', () => toggleMenu(false));
        
        // Close mobile menu when clicking a link
        const mobileLinks = document.querySelectorAll('.mobile-link');
        mobileLinks.forEach(link => {
          link.addEventListener('click', () => toggleMenu(false));
        });
      });
    </script>
    <style is:global>
      /* Ensure global styles if needed, though Tailwind covers most */
      html {
        scroll-behavior: smooth;
      }
    </style>
  </body>
</html>
